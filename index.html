<!DOCTYPE html>
<html lang="es">

<head>
  <base href="/R3full/">
  <meta charset="UTF-8">
  <title>FORMULARIO DE INGRESO</title>
  <link rel="icon" type="image/x-icon" href="/imagenes/r3.jpg">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" type="text/css" href="estilo.css">
  <style>
    body {
      background-image: url('https://cdn.pixabay.com/photo/2022/01/28/18/32/leaves-6975462_960_720.png');
      background-size: cover;
      background-position: center;
      background-attachment: fixed;
      background-repeat: no-repeat;
    }

    .centered-table {
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }

    table {
      background-color: rgba(255, 255, 255, 0.9);
      border-radius: 10px;
      box-shadow: 0px 4px 6px rgba(0, 0, 0, 0.1);
      padding: 20px;
    }
  </style>
</head>

<body>
  <div class="centered-table">
    <form id="loginForm">
      <table border="0">
        <tr>
          <td>
            <img src="imagenes/escudo.gif" alt="Escudo">
          </td>
          <td>
            <div class="container">
              <div class="mb-3">
                <label class="form-label">Documento</label>
                <input type="number" class="form-control" id="doc">
              </div>
              <div class="mb-3">
                <label class="form-label">Contraseña</label>
                <input type="password" class="form-control" id="pass">
              </div>
              <button type="submit" class="btn btn-primary">Ingresar</button>
              <div id="mensaje" class="mt-2"></div>
            </div>
          </td>
        </tr>
      </table>
    </form>
  </div>

  <script>
    document.getElementById("loginForm").addEventListener("submit", async function (event) {
      event.preventDefault();

      const documento = document.getElementById("doc").value.trim();
      const password = document.getElementById("pass").value.trim();
      const mensaje = document.getElementById("mensaje");

      if (!documento || !password) {
        mensaje.innerText = "Por favor, rellena todos los campos.";
        mensaje.style.color = "red";
        return;
      }

      try {
        const response = await fetch("https://r3full.onrender.com/api/auth/login", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ documento, password })
        });

        const data = await response.json();

        if (data.success) {
          sessionStorage.setItem('usuario', data.usuario);
          sessionStorage.setItem('id', data.id);
          mensaje.innerText = data.message || "Inicio de sesión exitoso.";
          mensaje.style.color = "green";

          // Redirigir según tipo de usuario
          if (data.usuario==="admin") {
            window.location.href = "paginas/admin.html";
          } else {
            window.location.href = "paginas/inicio.html";
          }
        } else {
          mensaje.innerText = data.message || "Credenciales incorrectas.";
          mensaje.style.color = "red";
        }

      } catch (error) {
        console.error("Error:", error);
        mensaje.innerText = "Error de conexión con el servidor.";
        mensaje.style.color = "red";
      }
    });
  </script>
</body>

</html>
